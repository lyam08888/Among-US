<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #45a049;
        }
        .test-button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .log {
            background: #333;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.success { background: #4CAF50; }
        .status.warning { background: #ff9800; }
        .status.error { background: #f44336; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ðŸ”Š Audio System Test</h1>
        
        <div id="status" class="status">
            Initializing audio system...
        </div>
        
        <div>
            <h3>Available Sounds:</h3>
            <div id="sound-buttons"></div>
        </div>
        
        <div>
            <h3>System Controls:</h3>
            <button class="test-button" onclick="initAudio()">Initialize Audio Context</button>
            <button class="test-button" onclick="testAllSounds()">Test All Available Sounds</button>
            <button class="test-button" onclick="clearLog()">Clear Log</button>
        </div>
        
        <div>
            <h3>Console Log:</h3>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script src="js/v4-advanced-audio.js"></script>
    <script>
        let audioSystem = null;
        let originalConsole = {};
        
        // Capture console output
        function setupConsoleCapture() {
            ['log', 'warn', 'error', 'info'].forEach(method => {
                originalConsole[method] = console[method];
                console[method] = function(...args) {
                    originalConsole[method].apply(console, args);
                    logToDiv(`[${method.toUpperCase()}] ${args.join(' ')}`);
                };
            });
        }
        
        function logToDiv(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function createSoundButtons() {
            const container = document.getElementById('sound-buttons');
            const availableSounds = [
                'button-click', 'footstep', 'task-complete', 'emergency', 
                'discussion', 'kill', 'vent', 'sabotage', 'lobby', 'ambient'
            ];
            
            availableSounds.forEach(soundId => {
                const button = document.createElement('button');
                button.className = 'test-button';
                button.textContent = soundId;
                button.onclick = () => testSound(soundId);
                container.appendChild(button);
            });
        }
        
        function testSound(soundId) {
            if (!audioSystem) {
                updateStatus('Audio system not initialized!', 'error');
                return;
            }
            
            logToDiv(`Testing sound: ${soundId}`);
            const result = audioSystem.playSound(soundId);
            
            if (result) {
                updateStatus(`Playing: ${soundId}`, 'success');
            } else {
                updateStatus(`Failed to play: ${soundId}`, 'warning');
            }
        }
        
        function testAllSounds() {
            if (!audioSystem) {
                updateStatus('Audio system not initialized!', 'error');
                return;
            }
            
            const sounds = Object.keys(audioSystem.soundDefinitions);
            let index = 0;
            
            function playNext() {
                if (index < sounds.length) {
                    const soundId = sounds[index];
                    logToDiv(`Testing sound ${index + 1}/${sounds.length}: ${soundId}`);
                    audioSystem.playSound(soundId);
                    index++;
                    setTimeout(playNext, 1000); // Wait 1 second between sounds
                } else {
                    updateStatus('All sounds tested!', 'success');
                }
            }
            
            playNext();
        }
        
        async function initAudio() {
            try {
                updateStatus('Initializing audio system...', 'info');
                audioSystem = new AdvancedAudioSystem();
                
                // Wait a bit for initialization
                setTimeout(() => {
                    if (audioSystem.isInitialized) {
                        updateStatus('Audio system ready!', 'success');
                        logToDiv(`Loaded ${audioSystem.loadedBuffers.size} audio buffers`);
                    } else {
                        updateStatus('Audio system initialized (waiting for user interaction)', 'warning');
                    }
                }, 2000);
                
            } catch (error) {
                updateStatus(`Failed to initialize: ${error.message}`, 'error');
                logToDiv(`Error: ${error.message}`);
            }
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // Initialize on page load
        window.addEventListener('load', () => {
            setupConsoleCapture();
            createSoundButtons();
            initAudio();
        });
    </script>
</body>
</html>